开始评估性能
node24               Thu Aug 31 14:30:36 2023  515.65.01
[0] NVIDIA A40       | 36'C,   0 % |   573 / 46068 MB |
[1] NVIDIA A40       | 36'C,   0 % |   573 / 46068 MB |
[2] NVIDIA A40       | 36'C,   0 % |   573 / 46068 MB |
[3] NVIDIA A40       | 35'C,   0 % |   573 / 46068 MB |
+ set -e
+ model_path=bert
+ task=WN18RR
+ [[ 2 -ge 1 ]]
+ [[ ! ./checkpoint/wn18rr/model_last.mdl == \-\-* ]]
+ model_path=./checkpoint/wn18rr/model_last.mdl
+ shift
+ [[ 1 -ge 1 ]]
+ [[ ! WN18RR == \-\-* ]]
+ task=WN18RR
+ shift
+++ dirname scripts/eval.sh
++ cd scripts
++ cd ..
++ pwd
+ DIR=/home/jiangyunqi/KGC/SimKGC
+ echo 'working directory: /home/jiangyunqi/KGC/SimKGC'
working directory: /home/jiangyunqi/KGC/SimKGC
+ '[' -z '' ']'
+ DATA_DIR=/home/jiangyunqi/KGC/SimKGC/data/WN18RR
+ test_path=/home/jiangyunqi/KGC/SimKGC/data/WN18RR/test.txt.json
+ [[ 0 -ge 1 ]]
+ neighbor_weight=0.05
+ rerank_n_hop=2
+ '[' WN18RR = WN18RR ']'
+ rerank_n_hop=5
+ '[' WN18RR = wiki5m_ind ']'
+ python3 -u evaluate.py --task WN18RR --is-test --eval-model-path ./checkpoint/wn18rr/model_last.mdl --neighbor-weight 0.05 --rerank-n-hop 5 --train-path /home/jiangyunqi/KGC/SimKGC/data/WN18RR/train.txt.json --valid-path /home/jiangyunqi/KGC/SimKGC/data/WN18RR/test.txt.json
[2023-08-31 14:30:49,088 INFO] Load 40943 entities from /home/jiangyunqi/KGC/SimKGC/data/WN18RR/entities.json
[2023-08-31 14:30:49,165 INFO] Triplets path: ['/home/jiangyunqi/KGC/SimKGC/data/WN18RR/test.txt.json', '/home/jiangyunqi/KGC/SimKGC/data/WN18RR/train.txt.json', '/home/jiangyunqi/KGC/SimKGC/data/WN18RR/valid.txt.json']
[2023-08-31 14:30:49,710 INFO] Triplet statistics: 22 relations, 6068 triplets
[2023-08-31 14:30:51,983 INFO] Args used in training: {
    "pretrained_model": "bert-base-uncased",
    "task": "WN18RR",
    "train_path": "/home/jiangyunqi/KGC/SimKGC/data/WN18RR/train.txt.json",
    "valid_path": "/home/jiangyunqi/KGC/SimKGC/data/WN18RR/valid.txt.json",
    "model_dir": "./checkpoint/wn18rr/",
    "warmup": 400,
    "max_to_keep": 3,
    "grad_clip": 10.0,
    "pooling": "mean",
    "dropout": 0.1,
    "use_amp": true,
    "t": 0.05,
    "use_link_graph": true,
    "eval_every_n_step": 10000,
    "pre_batch": 0,
    "pre_batch_weight": 0.5,
    "additive_margin": 0.02,
    "finetune_t": true,
    "max_num_tokens": 50,
    "use_self_negative": true,
    "workers": 4,
    "epochs": 50,
    "batch_size": 1024,
    "lr": 5e-05,
    "lr_scheduler": "linear",
    "weight_decay": 0.0001,
    "print_freq": 20,
    "seed": null,
    "is_test": false,
    "rerank_n_hop": 2,
    "neighbor_weight": 0.0,
    "eval_model_path": ""
}
[2023-08-31 14:30:52,437 INFO] Build tokenizer from bert-base-uncased
[2023-08-31 14:31:02,244 INFO] Load model from ./checkpoint/wn18rr/model_last.mdl successfully
  0%|          | 0/40 [00:00<?, ?it/s][2023-08-31 14:31:02,672 INFO] Start to build link graph from /home/jiangyunqi/KGC/SimKGC/data/WN18RR/train.txt.json
[2023-08-31 14:31:02,689 INFO] Start to build link graph from /home/jiangyunqi/KGC/SimKGC/data/WN18RR/train.txt.json
[2023-08-31 14:31:03,033 INFO] Done build link graph with 40559 nodes
[2023-08-31 14:31:03,049 INFO] Done build link graph with 40559 nodes
  2%|▎         | 1/40 [00:03<02:33,  3.94s/it]  8%|▊         | 3/40 [00:04<00:46,  1.26s/it] 10%|█         | 4/40 [00:05<00:38,  1.06s/it] 12%|█▎        | 5/40 [00:05<00:32,  1.08it/s] 15%|█▌        | 6/40 [00:06<00:28,  1.18it/s] 18%|█▊        | 7/40 [00:07<00:26,  1.26it/s] 20%|██        | 8/40 [00:07<00:24,  1.33it/s] 22%|██▎       | 9/40 [00:08<00:22,  1.37it/s] 25%|██▌       | 10/40 [00:09<00:21,  1.40it/s] 28%|██▊       | 11/40 [00:09<00:20,  1.43it/s] 30%|███       | 12/40 [00:10<00:19,  1.45it/s] 32%|███▎      | 13/40 [00:11<00:18,  1.46it/s] 35%|███▌      | 14/40 [00:11<00:17,  1.47it/s] 38%|███▊      | 15/40 [00:12<00:16,  1.48it/s] 40%|████      | 16/40 [00:13<00:16,  1.48it/s] 42%|████▎     | 17/40 [00:13<00:15,  1.49it/s] 45%|████▌     | 18/40 [00:14<00:14,  1.49it/s] 48%|████▊     | 19/40 [00:15<00:14,  1.49it/s] 50%|█████     | 20/40 [00:15<00:13,  1.50it/s] 52%|█████▎    | 21/40 [00:16<00:12,  1.49it/s] 55%|█████▌    | 22/40 [00:17<00:12,  1.49it/s] 57%|█████▊    | 23/40 [00:17<00:11,  1.49it/s] 60%|██████    | 24/40 [00:18<00:10,  1.49it/s] 62%|██████▎   | 25/40 [00:19<00:10,  1.49it/s] 65%|██████▌   | 26/40 [00:19<00:09,  1.49it/s] 68%|██████▊   | 27/40 [00:20<00:08,  1.49it/s] 70%|███████   | 28/40 [00:21<00:08,  1.49it/s] 72%|███████▎  | 29/40 [00:22<00:07,  1.49it/s] 75%|███████▌  | 30/40 [00:22<00:06,  1.49it/s] 78%|███████▊  | 31/40 [00:23<00:06,  1.49it/s] 80%|████████  | 32/40 [00:24<00:05,  1.49it/s] 82%|████████▎ | 33/40 [00:24<00:04,  1.49it/s] 85%|████████▌ | 34/40 [00:25<00:04,  1.49it/s] 88%|████████▊ | 35/40 [00:26<00:03,  1.49it/s] 90%|█████████ | 36/40 [00:26<00:02,  1.49it/s] 92%|█████████▎| 37/40 [00:27<00:02,  1.49it/s] 95%|█████████▌| 38/40 [00:28<00:01,  1.49it/s] 98%|█████████▊| 39/40 [00:28<00:00,  1.49it/s]100%|██████████| 40/40 [00:29<00:00,  1.48it/s]100%|██████████| 40/40 [00:29<00:00,  1.36it/s]
[2023-08-31 14:31:31,796 INFO] In test mode: True
[2023-08-31 14:31:31,800 INFO] Load 3134 examples from /home/jiangyunqi/KGC/SimKGC/data/WN18RR/test.txt.json
[2023-08-31 14:31:32,004 INFO] Start to build link graph from /home/jiangyunqi/KGC/SimKGC/data/WN18RR/train.txt.json
[2023-08-31 14:31:32,219 INFO] Done build link graph with 40559 nodes
[2023-08-31 14:31:39,280 INFO] predict tensor done, compute metrics...
  0%|          | 0/13 [00:00<?, ?it/s][2023-08-31 14:31:39,365 INFO] Start to build link graph from /home/jiangyunqi/KGC/SimKGC/data/WN18RR/train.txt.json
[2023-08-31 14:31:39,545 INFO] Done build link graph with 40559 nodes
  8%|▊         | 1/13 [00:01<00:12,  1.04s/it] 15%|█▌        | 2/13 [00:01<00:10,  1.01it/s] 23%|██▎       | 3/13 [00:02<00:09,  1.06it/s] 31%|███       | 4/13 [00:03<00:07,  1.14it/s] 38%|███▊      | 5/13 [00:04<00:06,  1.18it/s] 46%|████▌     | 6/13 [00:05<00:05,  1.18it/s] 54%|█████▍    | 7/13 [00:06<00:05,  1.12it/s] 62%|██████▏   | 8/13 [00:07<00:04,  1.11it/s] 69%|██████▉   | 9/13 [00:08<00:03,  1.15it/s] 77%|███████▋  | 10/13 [00:08<00:02,  1.15it/s] 85%|████████▍ | 11/13 [00:09<00:01,  1.17it/s] 92%|█████████▏| 12/13 [00:10<00:00,  1.16it/s]100%|██████████| 13/13 [00:10<00:00,  1.55it/s]100%|██████████| 13/13 [00:10<00:00,  1.21it/s]
[2023-08-31 14:31:50,084 INFO] forward metrics: {"mean_rank": 139.8229, "mrr": 0.7163, "hit@1": 0.6388, "hit@3": 0.768, "hit@10": 0.8545}
[2023-08-31 14:31:50,173 INFO] Evaluation takes 18.377 seconds
[2023-08-31 14:31:50,175 INFO] In test mode: True
[2023-08-31 14:31:50,178 INFO] Load 3134 examples from /home/jiangyunqi/KGC/SimKGC/data/WN18RR/test.txt.json
[2023-08-31 14:31:56,900 INFO] predict tensor done, compute metrics...
  0%|          | 0/13 [00:00<?, ?it/s]  8%|▊         | 1/13 [00:01<00:15,  1.29s/it] 15%|█▌        | 2/13 [00:02<00:14,  1.34s/it] 23%|██▎       | 3/13 [00:03<00:13,  1.30s/it] 31%|███       | 4/13 [00:05<00:11,  1.25s/it] 38%|███▊      | 5/13 [00:06<00:09,  1.23s/it] 46%|████▌     | 6/13 [00:07<00:08,  1.22s/it] 54%|█████▍    | 7/13 [00:08<00:07,  1.29s/it] 62%|██████▏   | 8/13 [00:10<00:06,  1.29s/it] 69%|██████▉   | 9/13 [00:11<00:05,  1.29s/it] 77%|███████▋  | 10/13 [00:12<00:03,  1.23s/it] 85%|████████▍ | 11/13 [00:13<00:02,  1.24s/it] 92%|█████████▏| 12/13 [00:15<00:01,  1.24s/it]100%|██████████| 13/13 [00:15<00:00,  1.03it/s]100%|██████████| 13/13 [00:15<00:00,  1.19s/it]
[2023-08-31 14:32:12,422 INFO] backward metrics: {"mean_rank": 235.4004, "mrr": 0.6283, "hit@1": 0.5565, "hit@3": 0.6688, "hit@10": 0.7549}
[2023-08-31 14:32:12,510 INFO] Evaluation takes 22.334 seconds
[2023-08-31 14:32:12,511 INFO] Averaged metrics: {'mean_rank': 187.6116, 'mrr': 0.6723, 'hit@1': 0.5977, 'hit@3': 0.7184, 'hit@10': 0.8047}
这个工作完成啦
